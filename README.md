# Medical Book Validation Service

–°–µ—Ä–≤–∏—Å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ª–∏—á–Ω—ã—Ö –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∫–Ω–∏–∂–µ–∫ (–≠–õ–ú–ö) —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∫ –≤–Ω–µ—à–Ω–µ–º—É API –†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Python 3.11+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### –ó–∞–ø—É—Å–∫ —Å Docker

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone <repository-url>
cd elmk-integration-service-main
```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**
```bash
# –° Docker Compose
docker-compose up

# –ò–ª–∏ —Å Docker –Ω–∞–ø—Ä—è–º—É—é
docker build -t medical-book-service .
docker run -p 8000:8000 --env-file .env medical-book-service
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–∞:**
```bash
curl http://localhost:8000/healthz
```

## üìö API Endpoints

### POST /api/v1/medical-book/validate

–í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∫–Ω–∏–∂–∫–∏.

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** Basic Auth

**Request Body:**
```json
{
    "elmk_number": "860102797025",
    "snils": "17648922116"
}
```

**Response:**
```json
{
    "elmk_status_name": "–î–µ–π—Å—Ç–≤—É–µ—Ç",
    "elmk_number": "86-01-027970-25",
    "first_name": "–•—É***—É–ª",
    "last_name": "–û***",
    "middle_name": "–ê–±–¥***–≤–Ω–∞",
    "snils": "176***16",
    "work_type": [
        "–†–∞–±–æ—Ç—ã, –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–∞–∫—Ç —Å –ø–∏—â–µ–≤—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞, —Ö—Ä–∞–Ω–µ–Ω–∏—è, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏"
    ],
    "decision_dt": "2025-07-11T07:52:57Z",
    "med_opinions_dt": "2026-07-02",
    "certification_dt": "2025-07-11",
    "recertification_dt": "2026-07-11",
    "fbuz_short_name": "–§–ë–£–ó ¬´–¶–ì–∏–≠ –≤ –•–ú–ê–û-–Æ–≥—Ä–µ¬ª",
    "created_fullname": "–ï–ü–ì–£"
}
```

### GET /healthz

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞.

### GET /metrics

–ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è Prometheus).

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `AUTH_USERNAME` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Basic Auth | - |
| `AUTH_PASSWORD` | –ü–∞—Ä–æ–ª—å Basic Auth | - |
| `EXTERNAL_API_URL` | URL –≤–Ω–µ—à–Ω–µ–≥–æ API | `https://elmk.rospotrebnadzor.ru/api/gov-services/elmks/public_elmk` |
| `EXTERNAL_API_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –≤–Ω–µ—à–Ω–µ–≥–æ API (—Å–µ–∫) | `30` |
| `RATE_LIMIT_REQUESTS` | –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ | `100` |
| `RATE_LIMIT_WINDOW` | –û–∫–Ω–æ –ª–∏–º–∏—Ç–∞ (—Å–µ–∫) | `3600` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `INFO` |
| `SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á | `your-secret-key-here` |

## ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### ELMK Number
- –§–æ—Ä–º–∞—Ç: —Ä–æ–≤–Ω–æ 12 —Ü–∏—Ñ—Ä
- –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: `^\d{12}$`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: `860102797025` ‚Üí `86-01-027970-25`

### SNILS
- –§–æ—Ä–º–∞—Ç: —Ä–æ–≤–Ω–æ 11 —Ü–∏—Ñ—Ä
- –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: `^\d{11}$`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Basic Auth** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤
- **HTTPS** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

```json
{
    "timestamp": "2025-08-03T13:42:22.024532Z",
    "level": "info",
    "event": "Request started",
    "method": "POST",
    "url": "/api/v1/medical-book/validate",
    "client_ip": "127.0.0.1"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -v

# –¢–æ–ª—å–∫–æ API —Ç–µ—Å—Ç—ã
pytest tests/test_api.py -v
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç health check
curl http://localhost:8000/healthz

# –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
curl -X POST http://localhost:8000/api/v1/medical-book/validate \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46c2VjdXJlcGFzc3dvcmQxMjM=" \
  -d '{"elmk_number": "860102797025", "snils": "17648922116"}'
```

## üê≥ Docker

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker build -t medical-book-service .
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker run -p 8000:8000 --env-file .env medical-book-service
```

### Docker Compose

```bash
docker-compose up -d
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
pip install -r requirements.txt
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**
```bash
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:**
```bash
pytest -v
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
elmk-integration-service-main/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ api.py          # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ auth.py         # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ external_api.py # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º API
‚îÇ   ‚îú‚îÄ‚îÄ main.py         # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py   # Middleware
‚îÇ   ‚îî‚îÄ‚îÄ models.py       # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_api.py     # API —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ test_models.py  # –ú–æ–¥–µ–ª–∏ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ pytest.ini
‚îî‚îÄ‚îÄ README.md
```

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### SSL –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–Ω–µ—à–Ω–∏–º API

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç curl —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π SSL –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ SSL –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ –≤–Ω–µ—à–Ω–µ–≥–æ API.

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ELMK –Ω–æ–º–µ—Ä–∞

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç ELMK –Ω–æ–º–µ—Ä –∏–∑ 12-–∑–Ω–∞—á–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç —Å –¥–µ—Ñ–∏—Å–∞–º–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –≤–Ω–µ—à–Ω–∏–º API.

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch (`git checkout -b feature/amazing-feature`)
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. Push –≤ branch (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
